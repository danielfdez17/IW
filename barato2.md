# barato2

## Contenido

~~~
barato2
barato2/bd.png
barato2/credentials.json
barato2/credentials.json.template
barato2/deploy.py
barato2/.gitattributes
barato2/.github
barato2/.github/CODEOWNERS
barato2/.gitignore
...                                                     <-- elimino el .git de la entrega: incluye todo el histórico y ocupa mucho
barato2/iwdata
barato2/iwdata/subastas
barato2/iwdata/subastas/1.jpg
barato2/iwdata/subastas/2.jpg
barato2/iwdata/subastas/3.jpg
barato2/iwdata/users
barato2/iwdata/users/975.jpg
barato2/iwdata.zip
barato2/iwdb.mv.db
barato2/iwdb.trace.db
barato2/mvnw
barato2/mvnw.cmd
barato2/notas_profe.txt
barato2/pom.xml
barato2/README.md
barato2/requirements.txt
barato2/src
barato2/src/main
barato2/src/main/java
barato2/src/main/java/es
barato2/src/main/java/es/ucm
barato2/src/main/java/es/ucm/fdi
barato2/src/main/java/es/ucm/fdi/iw
barato2/src/main/java/es/ucm/fdi/iw/business
barato2/src/main/java/es/ucm/fdi/iw/business/dto
barato2/src/main/java/es/ucm/fdi/iw/business/dto/ArchivedDTO.java
barato2/src/main/java/es/ucm/fdi/iw/business/dto/ChatMessage.java
barato2/src/main/java/es/ucm/fdi/iw/business/dto/CreateProductDTO.java
barato2/src/main/java/es/ucm/fdi/iw/business/dto/MessageDTO.java
barato2/src/main/java/es/ucm/fdi/iw/business/dto/ProductDTO.java
barato2/src/main/java/es/ucm/fdi/iw/business/dto/PujaDTO.javarealzando el chat.
barato2/src/main/java/es/ucm/fdi/iw/business/enums/EstadoSubasta.java
barato2/src/main/java/es/ucm/fdi/iw/business/enums/RepartoSubasta.java
barato2/src/main/java/es/ucm/fdi/iw/business/fileconfiglocal
barato2/src/main/java/es/ucm/fdi/iw/business/fileconfiglocal/LocalData.java
barato2/src/main/java/es/ucm/fdi/iw/business/mapper
barato2/src/main/java/es/ucm/fdi/iw/business/mapper/LocalDateTimeMapper.java
barato2/src/main/java/es/ucm/fdi/iw/business/mapper/MessageMapper.java
barato2/src/main/java/es/ucm/fdi/iw/business/mapper/PujaMapper.java
barato2/src/main/java/es/ucm/fdi/iw/business/mapper/SubastaMapper.java
barato2/src/main/java/es/ucm/fdi/iw/business/mapper/UserMapper.java
barato2/src/main/java/es/ucm/fdi/iw/business/model
barato2/src/main/java/es/ucm/fdi/iw/business/model/Lorem.java
barato2/src/main/java/es/ucm/fdi/iw/business/model/Message.java
barato2/src/main/java/es/ucm/fdi/iw/business/model/PujaEmbed.java
barato2/src/main/java/es/ucm/fdi/iw/business/model/Puja.java
barato2/src/main/java/es/ucm/fdi/iw/business/model/Subasta.java
barato2/src/main/java/es/ucm/fdi/iw/business/model/Transferable.java
barato2/src/main/java/es/ucm/fdi/iw/business/model/User.java
barato2/src/main/java/es/ucm/fdi/iw/business/repository
barato2/src/main/java/es/ucm/fdi/iw/business/repository/MessageRepository.java
barato2/src/main/java/es/ucm/fdi/iw/business/repository/PujaRepository.java
barato2/src/main/java/es/ucm/fdi/iw/business/repository/SubastaRepository.java
barato2/src/main/java/es/ucm/fdi/iw/business/repository/UserRepository.java
barato2/src/main/java/es/ucm/fdi/iw/business/services
barato2/src/main/java/es/ucm/fdi/iw/business/services/archived
barato2/src/main/java/es/ucm/fdi/iw/business/services/archived/ArchivedServiceImpl.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/archived/ArchivedServices.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/messages
barato2/src/main/java/es/ucm/fdi/iw/business/services/messages/MessageServiceImpl.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/messages/MessageService.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/product
barato2/src/main/java/es/ucm/fdi/iw/business/services/product/ProductServiceImpl.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/product/ProductService.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/puja
barato2/src/main/java/es/ucm/fdi/iw/business/services/puja/PujaServiceImpl.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/puja/PujaService.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/subastas
barato2/src/main/java/es/ucm/fdi/iw/business/services/subastas/SubastaServicesImpl.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/subastas/SubastasServices.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/user
barato2/src/main/java/es/ucm/fdi/iw/business/services/user/UserServiceImpl.java
barato2/src/main/java/es/ucm/fdi/iw/business/services/user/UserService.java
barato2/src/main/java/es/ucm/fdi/iw/config
barato2/src/main/java/es/ucm/fdi/iw/config/AppConfig.java
barato2/src/main/java/es/ucm/fdi/iw/config/GlobalModel.java
barato2/src/main/java/es/ucm/fdi/iw/config/StartupConfig.java
barato2/src/main/java/es/ucm/fdi/iw/config/WebSocketConfig.java
barato2/src/main/java/es/ucm/fdi/iw/config/WebSocketSecurityConfig.java
barato2/src/main/java/es/ucm/fdi/iw/controller
barato2/src/main/java/es/ucm/fdi/iw/controller/AdminController.java
barato2/src/main/java/es/ucm/fdi/iw/controller/ApiController.java
barato2/src/main/java/es/ucm/fdi/iw/controller/ArchivedController.java
barato2/src/main/java/es/ucm/fdi/iw/controller/ChatController.java
barato2/src/main/java/es/ucm/fdi/iw/controller/DetailProductController.java
barato2/src/main/java/es/ucm/fdi/iw/controller/RootController.java
barato2/src/main/java/es/ucm/fdi/iw/controller/UserController.java
barato2/src/main/java/es/ucm/fdi/iw/IwApplication.java
barato2/src/main/java/es/ucm/fdi/iw/scheduled
barato2/src/main/java/es/ucm/fdi/iw/scheduled/JobsSubastas.java
barato2/src/main/java/es/ucm/fdi/iw/security
barato2/src/main/java/es/ucm/fdi/iw/security/IwUserDetailsService.java
barato2/src/main/java/es/ucm/fdi/iw/security/LoginSuccessHandler.java
barato2/src/main/java/es/ucm/fdi/iw/security/SecurityConfig.java
barato2/src/main/resources
barato2/src/main/resources/application-container.properties
barato2/src/main/resources/application.properties
barato2/src/main/resources/import.sql
barato2/src/main/resources/static
barato2/src/main/resources/static/css
barato2/src/main/resources/static/css/admin.css
barato2/src/main/resources/static/css/archived.css
barato2/src/main/resources/static/css/bootstrap-5.3.3.css
barato2/src/main/resources/static/css/bootstrap.css.map
barato2/src/main/resources/static/css/chat.css
barato2/src/main/resources/static/css/chatvendedor.css
barato2/src/main/resources/static/css/custom.css
barato2/src/main/resources/static/css/login.css
barato2/src/main/resources/static/css/nav.css
barato2/src/main/resources/static/css/objeto.css
barato2/src/main/resources/static/css/reviews.css
barato2/src/main/resources/static/css/signup.css
barato2/src/main/resources/static/img
barato2/src/main/resources/static/img/BARATO.png
barato2/src/main/resources/static/img/default-pic.jpg
barato2/src/main/resources/static/img/favicon.ico
barato2/src/main/resources/static/img/logo.png
barato2/src/main/resources/static/img/reloj.jpeg
barato2/src/main/resources/static/img/usuario.png
barato2/src/main/resources/static/js
barato2/src/main/resources/static/js/ajax-demo.js
barato2/src/main/resources/static/js/archived.js
barato2/src/main/resources/static/js/bootstrap.bundle-5.1.3.js
barato2/src/main/resources/static/js/iw.js
barato2/src/main/resources/static/js/productdetail.js
barato2/src/main/resources/static/js/stomp.js
barato2/src/main/resources/static/js/util.js
barato2/src/main/resources/static/js/vote.js
barato2/src/main/resources/templates
barato2/src/main/resources/templates/admin.html
barato2/src/main/resources/templates/admin-subasta.html
barato2/src/main/resources/templates/archived.html
barato2/src/main/resources/templates/chat.html
barato2/src/main/resources/templates/error.html
barato2/src/main/resources/templates/fragments
barato2/src/main/resources/templates/fragments/footer.html
barato2/src/main/resources/templates/fragments/head.html
barato2/src/main/resources/templates/fragments/nav.html
barato2/src/main/resources/templates/index.html
barato2/src/main/resources/templates/login.html
barato2/src/main/resources/templates/perfil.html
barato2/src/main/resources/templates/productdetail.html
barato2/src/main/resources/templates/reviews.html
barato2/src/main/resources/templates/signup.html
barato2/src/main/resources/templates/user.html
barato2/src/test
barato2/src/test/java
barato2/src/test/java/es
barato2/src/test/java/es/ucm
barato2/src/test/java/es/ucm/fdi
barato2/src/test/java/es/ucm/fdi/iw
barato2/src/test/java/es/ucm/fdi/iw/plantilla
barato2/src/test/java/es/ucm/fdi/iw/plantilla/PlantillaApplicationTests.java
barato2/src/test/java/external
barato2/src/test/java/external/chatVendedor.feature
barato2/src/test/java/external/crearSubasta.feature
barato2/src/test/java/external/ExternalRunner.java
barato2/src/test/java/external/login.feature
barato2/src/test/java/external/test1.feature
barato2/src/test/java/external/test2.feature
barato2/src/test/java/external/ws.feature
barato2/src/test/java/internal
barato2/src/test/java/internal/InternalRunner.java
barato2/src/test/java/internal/users
barato2/src/test/java/internal/users/users.feature
barato2/src/test/java/internal/users/UsersRunner.java
barato2/src/test/java/karate-config.js
barato2/src/test/java/logback-test.xml
barato2/target
barato2/.vscode
barato2/.vscode/launch.json
barato2/.vscode/settings.json
~~~

## Corrección

### readme

* mejor titular el readme BaratoBarato, en lugar de IW 24/25

* no hace falta incluir cosas históricas en el README - está en github, y por tanto, versionado. Si alguien quiere mirar lo viejo, puede.

* deberíais detallar librerías que no son parte de la plantilla en el README - por ejemplo, mapstruct.

### funcionalidad

* No es posible subir imágenes de producto en Linux (no lo he probado en Windows). 

    + en sistemas no-windows (como por ejemplo el de despliegue), la ruta que usa `updatePicture` del `detailProductController` puede fallar - y no se usa `\` como separador de rutas. De ahí la importancia de usar el `LocalData` de la plantilla - que permite configurar dónde guardar información de la aplicación. Deberían cargarse y guardarse en el mismo sitio (para garantizar que se encuentran) 
    
    + guardáis imágenes de usuario en `user/<id>.jpg`, pero las cargáis de `users/<id>.jpg` -- ese plural está produciendo problemas.

* La forma de usar el chat es muy difícil de descubrir. No es que "Solo se puede chatear con usuarios que tengan subastas activas", sino que "sólo se pueden iniciar conversaciones desde una subasta activa, pulsando en éste icono". Ya puestos, cuando se reciben mensajes de chat, debería mostrarse de forma inmediata en el navbar del receptor, para que sepa que lo ha recibido. De igual forma, si tengo una conversación con mensajes sin leer, debería ser visible, para que sepa que debo seleccionarla.

* En la vista de perfil, debería ser visible cuánto tengo pujado dónde, y cuánto falta para que se resuelva. También debería poder ver qué he ganado, y debería poder quejarme al admin si las cosas que gano no llegan, o si me dan el cambiazo, y gano una cosa y me cambian la subasta a la mitad para que gane algo distinto. 

### diseño

* las clases internas de Java son una bendición - que permite mantener cosas que están de por sí fuertemente acopladas en un mismo fichero, minimizando la cantidad de "embalaje" y cambios de contexto necesarios para mantenerlos consistentes. Yo habría metido los DTOs y los mappers junto a sus respetivas entidades, porque no son nada independientes unos de otros. Tenéis el doble de clases que otros grupos, para funcionalidad equivalente.

* creo que os habéis complicado mucho la vida con la implementación. Podríais haber desarrollado la misma funcionalidad con un diseño mucho más sencillo.

### nota

* La usabilidad se queda corta, pero lo principal funciona: hay subastas, es posible apostar, es posible ganar, y los websockets dan soporte a conversaciones y actualizaciones en tiempo real.

* No veo agujeros grandes de seguridad. 

* Tenéis un 7, pero podéis subir fácilmente incluyendo soluciones a los ejercicios de este examen en la post-entrega. En particular, debería

    - ser posible subir imágenes de producto, independientemente de plataforma (con sólo ésto llegáis al 8). Mejor si es posibl subir varias imágenes de un mismo producto (esto lo podéis hacer subiéndolas a una carpeta `subasta/<id>/<nombre>.jpg`).

    - tener descripciones de producto algo mejores que un campo de texto sin formato. Mirad https://github.com/commonmark/commonmark-java - la idea es que el creador de la subasta escriba la descripción en markdown, y en la vista de usuario que quiere pujar, se vea renderizado como html.

    - haber perfiles más detallados, al menos de cara a que un usuario sepa cuál es su posición global (cuánto pujado dónde, cuándo se acaba cada puja, en cuáles voy ganando)

    - cualquier cambio que mejore la usabilidad/seguridad (ver por ejemplo preguntas de examen)

* si implementais todo lo anterior, llegaréis a sobresaliente. Si os quedáis a medio camino, dependerá de dónde os quedéis.

## Examen

Estas son las instrucciones del examen. Léelas con atención antes de nada, y pregunta cualquier duda sobre ellas cuanto antes. Después, verás las 6 preguntas de las que consta: A, B, C, D, E y F. No dejes ninguna pregunta sin contestar, aunque no consigas solucionarlas.

* Tienes acceso a Internet, pero *solamente* para consultar páginas o recursos que existían antes de comenzar el examen. Está *estrictamente prohibido* comunicarte con tus compañeros o con terceros. Puedes, por ejemplo, buscar documentación o ver preguntas y respuestas en StackOverflow. No puedes, por ejemplo, entrar en cualquier aplicación de mensajería o chat para comunicarte con terceros, o lanzar ChatGPT.

* Para tu entrega, usa exclusivamente los fuentes entregados con este enunciado. *No* uses fuentes descargados de GitHub, ni de ningún otro sitio sin consultarlo antes con el profesor.

* Recuerda que el objetivo de este examen no es mejorar la entrega, sino *demostrar que sabes bien cómo funciona*, y que te desenvuelves bien con los conceptos, herramientas y tecnologías vistas en la asignatura. 

* Si resuelves un ejercicio correctamente, no hace falta describir mucho cómo lo has conseguido: el código cambiado hablará por sí solo. Aun así, escribe por favor una frase en el fichero "markdown" (_tuproyecto.md_) del enunciado describiendo la idea de la solución.

* Si *no* te funciona algo, comenta, en el fichero "markdown" del enunciado (barato2.md) qué has intentado, porqué crees que falla, y cómo lo intentarías solucionar si tuvieses más tiempo. Aquí sí es importante describir tu solución, ya que será la única forma en que podré valorar tus conocimientos sobre el tema.

### pregunta A

¿En qué partes de este proyecto has trabajado más? ¿En cuáles menos? Indica tu participación describiendo las 3 ó 4 partes más importantes de tu aplicación, y el porcentaje del total de cada parte al que consideras que has contribuído. Contesta directamente en el `.md`, debajo de este texto y antes de la siguiente pregunta.

### pregunta B (hecho)

En muchas aplicaciones web, el registro de nuevos usuarios está protegido mediante un "captcha". Haz que, para registrar un nuevo usuario, sea necesario resolver uno muy sencillo de tu elección. Por ejemplo, genera 4 checkboxes de formulario con números aleatorios pares e impares y solicita (y verifica) que sólo pulsa en los pares.

### pregunta C (hecho)

Explica brevemente cómo funciona la resolución de una subasta una vez se acaba el plazo de la misma. Modifica el diálogo de creación de subasta para que no sólo se pueda especificar una fecha de inicio y final, sino también una hora - esto permite hacer pruebas más sencillas para ver quién ha ganado cuándo. 

### pregunta D

Haz que, si estás viendo la página de subastas activas y alguien aumenta la puja ganadora, se modifique el valor de la puja ganadora/persona que va ganando en la tabla, sin necesidad de recargar la vista. 

### pregunta E (hecho)

Modifica la vista de administrador para añadir enlaces directos a las subastas (en la vista de subasta) y a usuarios (en la vista de usuarios). Añade una columna "username" en la vista de usuarios. Añade dos botones grandes en la parte de arriba de estas vistas para pasar rápidamente de usuarios a subastas y viceversa. Elimina el drop-down del menú de Administrar, y que pulsarlo lleve directamente a administrar subastas. 

### pregunta F (hecho)

Siempre que los usuarios se pueden comunicar unos con otros, pueden hacer cosas feas - y más si hay dinero de por medio. Añade un enlace "quejas" en el navbar de los usuarios (y sólo los usuarios) que les permita enviar una queja al admin. La queja contendrá texto, autor, y fecha de creación, y el admin debería poder ver una tabla de quejas desde su vista de administrador (añade un botón a lo que pide el ejercicio E para acceder a esta tabla).

